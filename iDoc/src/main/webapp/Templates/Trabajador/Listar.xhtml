<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:form id="frmListarTrabajador">
        <p:growl life="1000"/>
        <p:dataTable id="dtTblTrabajador" widgetVar="wdtTblTrabajador" value="#{trabajadorC.listaTrabajador}" var="listaTrabajador"
                     rowStyleClass="#{listaTrabajador.ESTTRAB le 'Activo' ? null : 'inactivo'}"
                     rows="10" emptyMessage="No se encontrarón datos."
                     paginator="true" scrollable="false" scrollHeight="500" reflow="true"
                     rowsPerPageTemplate="5,10,15,20">

            <f:facet name="header">
                Trabajadores
            </f:facet>
            <p:column filterBy="#{listaTrabajador.ESTTRAB}"
                      filterMatchMode="equals">
                <f:facet name="filter">
                    <p:selectOneButton onchange="PF('wdtTblTrabajador').filter()">
                        <f:selectItem itemLabel="Activos" itemValue="A"/>
                    </p:selectOneButton>
                </f:facet>
            </p:column>
            <p:column headerText="Apellidos y Nombres">
                <h:outputLabel value="#{listaTrabajador.persona.COMPLETO}"/>
            </p:column>
            <p:column headerText="DNI">
                <h:outputLabel value="#{listaTrabajador.persona.DNIPER}"/>
            </p:column>
            <p:column headerText="Distrito">
                <h:outputLabel value="#{listaTrabajador.persona.CODUBI}"/>
            </p:column>
            <p:column headerText="Dirección">
                <h:outputLabel value="#{listaTrabajador.persona.DIRPER}"/>
            </p:column>
            <p:column headerText="Sexo"  
                      sortBy="#{listaTrabajador.persona.GENPER}">
                <h:outputLabel value="#{listaTrabajador.persona.GENPER}"/>
            </p:column>
            <p:column headerText="Fecha Inicio">
                <h:outputLabel value="#{listaTrabajador.FECINITRAB_T}">
                    <f:convertDateTime locale="es" pattern="dd MMM yyyy"  />
                </h:outputLabel>
            </p:column>
            <p:column headerText="Fecha Fin">
                <h:outputLabel value="#{listaTrabajador.FECFINTRAB_T}">
                    <f:convertDateTime locale="es" pattern="dd MMM yyyy"  />
                </h:outputLabel>
            </p:column>


            <p:column exportable="false" headerText="Acción">
                <h:panelGroup styleClass="mdl-button">
                    <p:commandButton update=":dlgDatosTrabajador" icon="ui-icon-pencil"
                                     title="Modificar" rendered="#{listaTrabajador.ESTTRAB eq 'A'}"
                                     oncomplete="PF('wdlgDatosTrabajador').show();">
                        <f:setPropertyActionListener value="#{listaTrabajador}" 
                                                     target="#{trabajadorC.trabajador}"/>
                    </p:commandButton>
                </h:panelGroup>
                <h:panelGroup styleClass="mdl-button">
                    <p:commandButton title="Resetear Contraseña" icon="ui-icon-refresh" 
                                     update="frmListarTrabajador"
                                     rendered="#{listaTrabajador.ESTTRAB eq 'A'}"
                                     actionListener="#{trabajadorC.resetearContra(listaTrabajador)}"/>
                </h:panelGroup>
                <h:panelGroup styleClass="mdl-button">
                    <p:commandButton title="Exportar" ajax="false" icon="ui-icon-print"
                                     rendered="#{listaTrabajador.ESTTRAB eq 'A'}"
                                     actionListener="#{trabajadorC.generarReporteI(listaTrabajador.IDTRAB)}"/>
                </h:panelGroup>
            </p:column>
            <p:blockUI block="dtTblTrabajador" trigger="dtTblTrabajador">
                Actualizando
            </p:blockUI>
        </p:dataTable>
        <p:commandButton value="Exportar Lista de Trabajadores en pdf" ajax="false" actionListener="#{trabajadorC.generarReporte(IDTRAB)}">
        </p:commandButton>
    </h:form>
    <p:dialog id="dlgDatosTrabajador" widgetVar="wdlgDatosTrabajador" blockScroll="true" modal="true"
              header="Datos del Trabajador" closeOnEscape="true">
        <div class="ui-fluid">
            <h:form id="frmEditarTrabajador">
                <div class="ui-g">
                    <div class="ui-g-12">
                        <h:panelGroup styleClass="md-inputfield">
                            <p:calendar value="#{trabajadorC.trabajador.FECINITRAB_T}" 
                                        readonlyInput="true" required="true" disabled="true"
                                        locale="es" navigator="false" pattern="dd MMM yyyy" >
                            </p:calendar>
                            <p:outputLabel value="Fecha Inicio" for="@previous"/>
                        </h:panelGroup>
                    </div>
                    <div class="ui-g-12">
                        <h:panelGroup styleClass="md-inputfield">
                            <p:calendar value="#{trabajadorC.trabajador.FECFINTRAB_T}" 
                                        readonlyInput="true" required="true"
                                        locale="es" navigator="false" pattern="dd MMM yyyy" >
                            </p:calendar>
                            <p:outputLabel value="Fecha Fin" for="@previous"/>
                        </h:panelGroup>
                    </div>
                    <div class="ui-g-12">
                        <div class="ui-g-6">
                            <p:commandButton value="Modificar" actionListener="#{trabajadorC.editar()}"
                                             oncomplete="if(!args.validationFailed)PF('wdlgDatosTrabajador').hide();"
                                             update=":frmListarTrabajador :frmRegistrarTrabajador">
                                <p:confirm header="Confirmation" message="¿Quiere Modificar?" icon="ui-icon-alert" />
                                <p:tooltip trackMouse="true"/>
                            </p:commandButton>
                            <p:confirmDialog global="true" closeOnEscape="true">
                                <p:commandButton value="Si" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                                <p:commandButton value="No" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                            </p:confirmDialog>
                        </div>
                        <div class="ui-g-6">
                            <h:panelGroup styleClass="mdl-button">
                                <p:commandButton value="Cancelar" immediate="true"
                                                 oncomplete="PF('wdlgDatosTrabajador').hide();"/>
                            </h:panelGroup>
                        </div>
                    </div>

                </div>

            </h:form>
        </div>
    </p:dialog>

</html>

