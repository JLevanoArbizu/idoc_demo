<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="../Templates/Default.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:param name="tituloPagina" value="Actas"/>

    <ui:define name="contenidoPagina">
        <f:event type="preRenderView" listener="#{loginC.seguridadSesion()}"/>
        <f:event type="preRenderView" listener="#{actaC.cabecera.login.setIDLOG(loginC.loginSesion.IDLOG)}"/>
        <h:form>

        </h:form>

        <!--Ver las incidencias de un documento seleccionado, editar las que tiene o agregar nuevas-->
        <p:dialog widgetVar="wvIncidencia" header="Incidencia" id="dIncidencia">
            <h:form id="frmIncidencia">
                <h:form id="frmListarIncidencia">
                    <p:dataTable id="dtTblIncidencia"
                                 value="#{incidenciaC.lista}" var="listaIncidencia"
                                 rowKey="#{listaIncidencia.IDINC}" selection="#{incidenciaC.incidenciaSeleccionado}"
                                 selectionMode="single" filteredValue="#{incidenciaC.listaFiltrado}"
                                 rows="10" emptyMessage="No se encontrarón datos."
                                 paginator="true" scrollable="false" scrollHeight="500"
                                 rowsPerPageTemplate="5,10,15,20">

                        <f:facet name="header">
                            <p:commandButton value="Agregar Incidencia" oncomplete="PF('wvRegistrarIncidencia').show();"
                                             update="dIncidencia"/>
                        </f:facet>

                        <p:column headerText="Documento">
                            <h:outputText value="#{listaIncidencia.acta.IDACTA}" />
                        </p:column>
                        <p:column headerText="Tipo">
                            <h:outputText value="#{listaIncidencia.tipoIncidencia.IDINCTIP}"/>
                        </p:column>
                        <p:column headerText="Fecha">
                            <h:outputText value="#{listaIncidencia.FECINC}">
                                <f:convertDateTime pattern="dd/MMM/yyyy"  />
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Motivo">
                            <h:outputText value="#{listaIncidencia.MOTINC}"/>
                        </p:column>
                    </p:dataTable>

                    <p:contextMenu for="dtTblIncidencia">
                        <p:menuitem update="dIncidencia" icon="ui-icon-pencil"
                                    value="Modificar"
                                    oncomplete="PF('wdlgDatosIncidencia').show();"/>
                        <p:menuitem value="Eliminar" actionListener="#{incidenciaC.eliminar()}" 
                                    update="dIncidencia"
                                    icon="ui-icon-circle-close"/>
                    </p:contextMenu>
                </h:form>

                <p:dialog id="dlgDatosIncidencia" widgetVar="wdlgDatosIncidencia" 
                          header="Datos de Incidencia" closeOnEscape="true">
                    <h:form id="frmEditarIncidencia">
                        <p:panelGrid columns="2" columnClasses="ui-g-12 ui-md-2,ui-g-12 ui-md-4,ui-g-12 ui-md-2,ui-g-12 ui-md-4" 
                                     layout="grid">
                            <p:outputLabel value="Documento"/>

                            <p:outputLabel value="Tipo de Incidencia"/>
                            <p:selectOneMenu value="#{incidenciaC.incidenciaSeleccionado.tipoIncidencia.IDINCTIP}">
                                <f:selectItems value="#{incidenciatipoC.lista}" var="tipoIncidencia"
                                               itemLabel="#{tipoIncidencia.NOMINCTIP}"
                                               itemValue="#{tipoIncidencia.IDINCTIP}"/>
                            </p:selectOneMenu>

                            <p:outputLabel value="Fecha"/>
                            <p:calendar id="popup" value="#{incidenciaC.incidenciaSeleccionado.FECINC}" 
                                        readonlyInput="true" required="true" requiredMessage="Fecha requerida"
                                        navigator="false" pattern="dd/MMM/yyyy" />

                            <p:outputLabel value="Motivo"/>
                            <p:inputText value="#{incidenciaC.incidenciaSeleccionado.MOTINC}"  style="width: 50vh" 
                                         requiredMessage="Motivo Requerido."
                                         required="true" 
                                         onblur="this.value = this.value.toUpperCase()">
                                <p:keyFilter regEx='/[\a-z ]/i'/>
                            </p:inputText>
                        </p:panelGrid>     
                        <p:selectOneRadio value="#{incidenciaC.incidenciaSeleccionado.ESTINC}" 
                                          requiredMessage="Seleccione Estado de la Incidencia."
                                          style="width: 50vh"
                                          unselectable="false" required="true">
                            <f:selectItem itemLabel="Activo" itemValue="A"/>
                            <f:selectItem itemLabel="Inactivo" itemValue="I"/>
                        </p:selectOneRadio>
                        <p:commandButton value="Modificar" actionListener="#{incidenciaC.editar()}"
                                         oncomplete="if(!args.validationFailed)PF('wdlgDatosIncidencia').hide();"
                                         update="dIncidencia">
                            <p:confirm header="Confirmacion" message="¿Quiere Modificar?" icon="ui-icon-alert" />
                        </p:commandButton>

                        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                            <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                        </p:confirmDialog>

                        <p:commandButton value="Cancelar" immediate="true" 
                                         oncomplete="PF('wdlgDatosIncidencia').hide();"/>
                    </h:form>

                </p:dialog>

                <p:dialog header="Registrar Incidencia" widgetVar="wvRegistrarIncidencia">
                    <h:form id="frmRegistrarIncidencia">
                        <p:growl life="1000"/>
                        <p:panelGrid columns="2" columnClasses="ui-g-12 ui-md-2,ui-g-12 ui-md-4,ui-g-12 ui-md-2,ui-g-12 ui-md-4" 
                                     layout="grid">
                            <p:outputLabel value="Documento"/>

                            <p:outputLabel value="Tipo de Incidencia"/>
                            <p:selectOneMenu value="#{incidenciaC.incidencia.tipoIncidencia.IDINCTIP}">
                                <f:selectItems value="#{incidenciatipoC.lista}" var="tipoIncidencia"
                                               itemLabel="#{tipoIncidencia.NOMINCTIP}"
                                               itemValue="#{tipoIncidencia.IDINCTIP}"/>
                            </p:selectOneMenu>

                            <p:outputLabel value="Fecha"/>
                            <p:calendar id="popup" value="#{incidenciaC.incidencia.FECINC}" 
                                        readonlyInput="true" required="true" requiredMessage="Fecha requerida"
                                        navigator="false" pattern="dd/MMM/yyyy" />

                            <p:outputLabel value="Motivo"/>
                            <p:inputText value="#{incidenciaC.incidencia.MOTINC}"  style="width: 50vh" 
                                         requiredMessage="Motivo Requerido."
                                         required="true" 
                                         onblur="this.value = this.value.toUpperCase()">
                                <p:keyFilter regEx='/[\a-z ]/i'/>
                            </p:inputText>
                        </p:panelGrid>
                        <p:commandButton actionListener="#{incidenciaC.registrar()}" value="Guardar"
                                         update="dIncidencia"
                                         oncomplete="if(!args.validationFailed)PF('wvRegistrarIncidencia').hide();"/>
                    </h:form>
                </p:dialog>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>

