<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:form id="frmListarTrabajador">
        <p:growl life="1000"/>
        <p:dataTable id="dtTblTrabajador"  value="#{trabajadorC.listaTrabajador}" var="listaTrabajador"
                     rowStyleClass="#{listaTrabajador.ESTTRAB le 'Activo' ? null : 'inactivo'}"
                     rows="10" emptyMessage="No se encontrarón datos."
                     paginator="true" scrollable="true" scrollHeight="500"
                     rowsPerPageTemplate="5,10,15,20">

            <f:facet name="header">
                Trabajadores
            </f:facet>     
            <p:column headerText="Apellidos y Nombres" 
                      style="font-weight: bold">
                <h:outputLabel value="#{listaTrabajador.persona.COMPLETO}" style="font-weight: normal" />
            </p:column>
            <p:column headerText="DNI" 
                      style="font-weight: bold;">
                <h:outputLabel value="#{listaTrabajador.persona.DNIPER}"  style="font-weight: normal" />
            </p:column>
            <p:column headerText="Distrito"  style="font-weight: bold">
                <h:outputLabel value="#{listaTrabajador.persona.CODUBI}"  style="font-weight: normal" />
            </p:column>
            <p:column headerText="Dirección"  style="font-weight: bold">
                <h:outputLabel value="#{listaTrabajador.persona.DIRPER}"  style="font-weight: normal" />
            </p:column>
            <p:column headerText="Sexo"  
                      sortBy="#{listaTrabajador.persona.GENPER}" 
                      style="font-weight: bold;">
                <h:outputLabel value="#{listaTrabajador.persona.GENPER}" style="font-weight: normal" />
            </p:column>
            <p:column headerText="Fecha Inicio"  style="font-weight: bold">
                <h:outputLabel value="#{listaTrabajador.FECINITRAB_T}" style="font-weight: normal">
                    <f:convertDateTime locale="es" pattern="dd MMM yyyy"  />
                </h:outputLabel>
            </p:column>
            <p:column headerText="Fecha Fin"  style="font-weight: bold">
                <h:outputLabel value="#{listaTrabajador.FECFINTRAB_T}" style="font-weight: normal">
                    <f:convertDateTime locale="es" pattern="dd MMM yyyy"  />
                </h:outputLabel>
            </p:column>

            <p:column exportable="false">
                <p:commandButton update=":dlgDatosTrabajador" icon="ui-icon-pencil"
                                 class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-button--colored"
                                 title="Modificar" rendered="#{listaTrabajador.ESTTRAB eq 'A'}"
                                 oncomplete="PF('wdlgDatosTrabajador').show();">
                    <f:setPropertyActionListener value="#{listaTrabajador}" 
                                                 target="#{trabajadorC.trabajador}"/>
                </p:commandButton>
                <p:commandButton rendered="#{listaTrabajador.ESTTRAB eq 'A'}" ajax="false"
                                 title="Guardar" actionListener="#{trabajadorCC.generarReporte(listaTrabajador)}"/>


                <p:commandButton value="Resetear Contraseña" update="frmListarTrabajador"
                                 rendered="#{listaTrabajador.ESTTRAB eq 'A'}"
                                 actionListener="#{trabajadorC.resetearContra(listaTrabajador)}"/>
            </p:column>
            <p:blockUI block="dtTblTrabajador" trigger="dtTblTrabajador">
                Actualizando
            </p:blockUI>
        </p:dataTable>
    </h:form>
    <p:dialog id="dlgDatosTrabajador" widgetVar="wdlgDatosTrabajador" 
              class="mdl-dialog"
              header="Datos del Trabajador" closeOnEscape="true">
        <h:form id="frmEditarTrabajador" class="mdl-dialog__content">
            <p:panelGrid columns="2">
                <p:outputLabel value="Fecha Inicio"/>
                <p:calendar value="#{trabajadorC.trabajador.FECINITRAB_T}" 
                            readonlyInput="true" required="true" disabled="true"
                            locale="es" navigator="true" pattern="dd MMM yyyy" >
                </p:calendar>

                <p:outputLabel value="Fecha Fin"/>
                <p:calendar value="#{trabajadorC.trabajador.FECFINTRAB_T}" 
                            readonlyInput="true" required="true"
                            locale="es" navigator="true" pattern="dd MMM yyyy" >
                </p:calendar>
            </p:panelGrid>
            <p:commandButton value="Modificar" actionListener="#{trabajadorC.editar()}"
                             oncomplete="if(!args.validationFailed)PF('wdlgDatosTrabajador').hide();"
                             update=":frmListarTrabajador :frmRegistrarTrabajador">

                <p:confirm header="Confirmation" message="¿Quiere Modificar?" icon="ui-icon-alert" />
            </p:commandButton>

            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
            </p:confirmDialog>

            <p:commandButton value="Cancelar" immediate="true"
                             oncomplete="PF('wdlgDatosTrabajador').hide();"/>
        </h:form>

    </p:dialog>
</html>

